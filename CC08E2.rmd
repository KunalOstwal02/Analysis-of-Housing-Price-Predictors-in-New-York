---
title: "Price Analysis of New York Homes"
author: "CC08E2"
date: "2022-10-05"
output: pdf_document
---

# Group Contract
>
Group number: CC08E2
> 
Name: Kunal Ostwal - 500668171
>
GitHub link: https://github.sydney.edu.au/kost6112/CC08E2.git
>
I agree to:
>
* Abide by the terms of this contract in relation to the group assessment for DATA2002/2902.
* Store all my written and code contributions to the assessment in the GitHub repository.
* Keep a record of my other contributions to the assessment (e.g. discussions, emails, meetings attended). A copy of this may be requested by the coordinator.
* The group will maintain a promote high academic standars, commit to a culture of intregity, and support academic freedom.
* The group will help encourage and where possible help other members when difficulties with the work may arise.
* Work collaboratively and contribute equitably to group work, projects and other learning experiences
* Communication to be taken place over created WhatsApp group and during scheduled group meetings.
* All members will ensure notifcations for WhatsApp group are on and will read and respond if required to all recieved messages.
* Daily updates provided by group members on the progress of the work allocated to them.
* Weekly meetings during during lab tutorials and/or extra informal meetings as any issues arise during the course of the project.
>
I understand that:
>
* My agreement to these terms is indicated through the act of submitting this in Canvas.
* If I fail to meet my obligations as detailed in this group contract then I have failed to meet the assessment requirements for DATA2002/2902 and may be awarded a mark of zero for some or all of the project components.


\newpage
# Exploratory Data Analysis

**Dataset:** House Prices of New York  
**Variable of Interest:** Age

```{r, message=FALSE, echo=FALSE}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(psych)
library(scales)
library(qtlcharts)
```

```{r, message=FALSE, echo=FALSE}
#houses <- read.table(file = ".\\resources\\housing-prices-ge19.txt", sep = "\t", header = TRUE)
houses <- read.table(file = "./resources/housing-prices-ge19.txt", sep = "\t", header = TRUE)

```

```{r, echo=FALSE, message=FALSE}
houses <- houses %>% 
  mutate(
    Waterfront = factor(Waterfront),
    New.Construct = factor(New.Construct),
    Central.Air = factor(Central.Air),
    Fuel.Type = factor(Fuel.Type),
    Heat.Type = factor(Heat.Type),
    Sewer.Type = factor(Sewer.Type),
    Test = factor(Test)
  )

```
```{r}
str(houses)
```

```{r, warning=FALSE}
describe(houses[, c("Price" ,"Lot.Size", "Age", "Land.Value", "Living.Area", "Pct.College", "Bedrooms", "Fireplaces", "Bathrooms", "Rooms")], fast=TRUE)
```
### Age vs Price
```{r, out.width="45%", fig.align='center', message=FALSE, echo=FALSE}
houses %>% ggplot() + 
  aes(y = Price, x = Age) + 
  geom_point(alpha = 0.25) + 
  geom_smooth(method = lm) + 
  labs(x = "Age") + 
  scale_y_continuous(labels = comma)
```
Although at the risk of extrapolation, one can infer that age and price are inversely related.  

### Age vs Bedrooms

```{r, out.width="45%", fig.align='center', message=FALSE, echo=FALSE}
houses %>% ggplot() + 
  aes(x = Age, y = Bedrooms, group = Bedrooms) + 
  geom_boxplot(alpha = 0.5) + 
  scale_y_continuous(breaks = 1:8)
```

We observe that the houses with 5+ bedrooms are comparatively older that <5 bedrooms houses. For less than 5 bedroom houses, the trend is opposite. Four bedroom houses have been built more recently than 1 bedroom houses.  

### Age vs Heat Type
```{r, out.width="45%", fig.align='center', message=FALSE, echo=FALSE}
houses %>% ggplot() + 
  aes(y = Age, x = Heat.Type, color = Heat.Type) + 
  geom_boxplot(alpha = 0.5) 
```
We observe here that houses with no heating system are older than ones that have a heating system.  

```{r}
houses[,-which(sapply(df, class) == "factor")]

houses_cor_mat = houses[,-which(sapply(df, class) == "factor")] %>%
  data.frame() %>% 
  rownames_to_column(var = "var1") %>% 
  gather(key = "var2", value = "cor", -var1)

```

## Analyzing the factors that determine the price of the house

We can see in the correlation matrix that the `Price`, `Living.Area` factor pair has the highest correlation relationship. 
```{r}
# select numeric or integer type factors
temp = select(houses, - which(sapply(houses, class) == "factor"))
cor_mat = cor(temp)

melted_cor_mat = cor_mat %>%
  data.frame() %>% 
  rownames_to_column(var = "var1") %>% 
  gather(key = "var2", value = "cor", -var1)

# correlation matrix heatmap
melted_cor_mat %>% ggplot() + 
  aes(x=var1, y=var2, fill=cor) + 
  geom_tile() + theme_minimal(base_size = 15) +
  scale_fill_gradient2(
    low = "red", high = "darkgreen", mid = "white", 
    midpoint = 0, limit = c(-1,1)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# interactive plot using 'qtlcharts'
iplotCorr(temp)
```

```{r}
lm = lm(Price ~ Living.Area, data = houses)

#plot(Price ~ Living.Area, data = housing)
#abline(lm, lwd = 3, col = "red")

houses %>% ggplot() + 
  aes(y = Price, x = Living.Area) + 
  geom_point(alpha = 0.25) + 
  geom_smooth(method = "lm") + 
  labs(x = "Age") + 
  scale_y_continuous(labels = comma)
```
```{r}
summary(lm)
```

```{r}
M0 = lm(Price ~ 1, data = houses)

M1 = lm(Price ~ ., data = houses)

```         

```{r}
round(summary(M1)$coef,3)
```
```{r}
res = bind_rows(broom::glance(M1),
                broom::glance(M0))

res$model = c("All", "Null")
res %>% pivot_longer(
  cols = -model,
  names_to = "metric",
  values_to = "value"
) %>% pivot_wider(names_from = "model") %>% 
  gt::gt() %>%
  gt::fmt_number(columns = 2:3,
                 decimals = 2) %>% 
  gt::fmt_missing()
  
  
```


### Forward and Backward Model

```{r}
M0 = lm(Price ~ 1, data = houses)  # Null model
Mf = lm(Price ~ . - Test, data = houses)  # Full model
```

```{r}
step_back = step(Mf, direction = "backward", trace = TRUE)

summary(step_back)

step_forward = step(M0, scope = list(lower = M0, upper = Mf), direction = "forward", trace = TRUE)

summary(step_forward)
```


## Comparison of backward and forward model

```{r}
sjPlot::tab_model(step_forward, step_back, show.ci = FALSE, show.aic = TRUE,
  dv.labels = c("Forward model", "Backward model"))
```

## Assumptions

1.  Linearity: The residuals plotted appear symmetrically distributed above and below zero with some outliers above zero, therefore the data is assumed to be linear.

```{r}
# Checking assumtpions - Linearity and Homoskedacity


plot(lm$residuals)	
abline(h=0, lwd = 3, col = "red")
plot(M1$residuals)
abline(h=0, lwd = 3, col = "red")

```
2.  Independence: We take it for granted that the data has been independently collected.

3.  Homoskedacity: In both models, it appears the variance is constant in the QQ plot for each error term and therefore the homoskedacity assumption is satisfied.

4.  Normality: The majority of points lie close to the diagonal line in both QQ plots, however, there are many outliers in the upper tail so the normality assumption is moderately well satisfied. Furthermore, we have a large sample size, and so can use the central limit theorem to justify approximately valid inferences under a normality assumption.

```{r}
# Checking assumptions - Normality

lm.res = lm$residuals
M1.res = M1$residuals

ggplot(data.frame(lm.res)) +
  aes(sample = lm.res) + 
  geom_qq_line() + 
  geom_qq(size=1)

ggplot(data.frame(M1.res)) +
  aes(sample = M1.res) + 
  geom_qq_line() + 
  geom_qq(size=1)
```




























